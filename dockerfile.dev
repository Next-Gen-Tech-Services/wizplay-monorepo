# Dockerfile.dev
FROM node:alpine

# Install necessary tools
RUN apk add --no-cache libc6-compat && \
    npm install -g pnpm turbo

# Set working directory
WORKDIR /app

# Copy package files for dependency installation
COPY package.json pnpm-lock.yaml* pnpm-workspace.yaml turbo.json ./

# Create directories for apps and packages
RUN mkdir -p apps packages

# Copy all package.json files from packages and apps
COPY packages/*/package.json ./packages/*/
COPY apps/*/package.json ./apps/*/

# Install dependencies
RUN pnpm install

# Copy source code
COPY . .

# Create turbo cache directory
RUN mkdir -p .turbo

# Expose common ports
EXPOSE 3000 4001 4002 4003 4004 4005

# Set default command
CMD ["pnpm", "turbo", "dev"]